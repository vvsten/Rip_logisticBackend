<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—è–≤–∫–∞ ‚Ññ{{ .logistic_request.ID }} - GruzDelivery</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <header class="header">
        <a href="/" class="logo">
            <div class="logo-icon">üöö</div>
            GruzDelivery
        </a>
        <a href="/logistic-request/quote" class="home-btn">üßÆ –†–∞—Å—á—ë—Ç –ø–µ—Ä–µ–≤–æ–∑–∫–∏</a>
    </header>

    <div class="container">
        <div class="order-details">
            <h1 class="order-details-title">–õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—è–≤–∫–∞ ‚Ññ{{ .logistic_request.ID }}</h1>
            
            <div class="order-params">
                <div class="param-item">
                    <div class="param-label">–û—Ç–∫—É–¥–∞</div>
                    <div class="param-value">{{ .logistic_request.FromCity }}</div>
                </div>
                <div class="param-item">
                    <div class="param-label">–ö—É–¥–∞</div>
                    <div class="param-value">{{ .logistic_request.ToCity }}</div>
                </div>
                <div class="param-item">
                    <div class="param-label">–í–µ—Å –≥—Ä—É–∑–∞</div>
                    <div class="param-value">{{ .logistic_request.Weight }} –∫–≥</div>
                </div>
                <div class="param-item">
                    <div class="param-label">–î–ª–∏–Ω–∞</div>
                    <div class="param-value">{{ .logistic_request.Length }} –º</div>
                </div>
                <div class="param-item">
                    <div class="param-label">–®–∏—Ä–∏–Ω–∞</div>
                    <div class="param-value">{{ .logistic_request.Width }} –º</div>
                </div>
                <div class="param-item">
                    <div class="param-label">–í—ã—Å–æ—Ç–∞</div>
                    <div class="param-value">{{ .logistic_request.Height }} –º</div>
                </div>
            </div>

            <div class="order-summary">
                <div class="order-summary-title">–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</div>
                <div class="order-summary-value">{{ .logistic_request.TotalCost }} —Ä—É–±–ª–µ–π</div>
            </div>

            <div class="order-summary" style="background-color: var(--accent-blue);">
                <div class="order-summary-title">–°—Ä–æ–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏</div>
                <div class="order-summary-value">{{ .logistic_request.TotalDays }} –¥–Ω–µ–π</div>
            </div>

            <div class="order-status-section">
                <div class="order-status-title">–°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏</div>
                <div class="order-status-value" id="order-status">{{ .logistic_request.Status }}</div>
                
                <div class="status-buttons">
                    <button class="status-btn" onclick="updateStatus('pending')" data-status="pending">‚è≥ –û–∂–∏–¥–∞–µ—Ç</button>
                    <button class="status-btn" onclick="updateStatus('processing')" data-status="processing">üîÑ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è</button>
                    <button class="status-btn" onclick="updateStatus('shipped')" data-status="shipped">üöö –û—Ç–ø—Ä–∞–≤–ª–µ–Ω</button>
                    <button class="status-btn" onclick="updateStatus('delivered')" data-status="delivered">‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω</button>
                    <button class="status-btn" onclick="updateStatus('cancelled')" data-status="cancelled">‚ùå –û—Ç–º–µ–Ω–µ–Ω</button>
                </div>
            </div>
        </div>

        <div class="order-services">
            <h2 class="order-services-title">–£—Å–ª—É–≥–∏ –≤ –∑–∞—è–≤–∫–µ</h2>
            
            {{ range $index, $service := .services }}
            <div class="order-service-item">
                <img src="{{ $service.ImageURL }}" alt="{{ $service.Name }}" class="order-service-image" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgZmlsbD0iI2Y4ZjlmYSIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IiM2Yzc1N2QiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5ObyBJbWFnZTwvdGV4dD48L3N2Zz4='">
                <div class="order-service-info">
                    <div class="order-service-name">{{ $service.Name }}</div>
                    <div class="order-service-details">
                        <strong>–¶–µ–Ω–∞:</strong> {{ $service.Price }} —Ä—É–±. | 
                        <strong>–°—Ä–æ–∫–∏:</strong> {{ $service.DeliveryDays }} –¥–Ω–µ–π | 
                        <strong>–ú–∞–∫—Å. –≤–µ—Å:</strong> {{ $service.MaxWeight }} –∫–≥ | 
                        <strong>–ú–∞–∫—Å. –æ–±—ä–µ–º:</strong> {{ $service.MaxVolume }} –º¬≥
                    </div>
                    <div class="order-service-params">
                        <div class="order-service-param">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {{ index $.logistic_request.Services $index "Quantity" }}</div>
                        <div class="order-service-param">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: {{ index $.logistic_request.Services $index "Comment" }}</div>
                    </div>
                </div>
            </div>
            {{ end }}
        </div>

        <div style="text-align: center; margin-top: 2rem;">
            <a href="/" class="home-btn">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —É—Å–ª—É–≥–∞–º</a>
        </div>
    </div>

    <script>
        function updateStatus(newStatus) {
            const logisticRequestId = {{ .logistic_request.ID }};
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            const statusElement = document.getElementById('order-status');
            statusElement.textContent = '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...';
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
            fetch(`/api/logistic-requests/${logisticRequestId}/status`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ status: newStatus })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                    statusElement.textContent = newStatus;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
                    document.querySelectorAll('.status-btn').forEach(btn => {
                        btn.classList.remove('active');
                        if (btn.dataset.status === newStatus) {
                            btn.classList.add('active');
                        }
                    });
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    showNotification('–°—Ç–∞—Ç—É—Å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!', 'success');
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞: ' + data.error, 'error');
                    statusElement.textContent = '{{ .logistic_request.Status }}'; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞—Ä—ã–π —Å—Ç–∞—Ç—É—Å
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
                statusElement.textContent = '{{ .logistic_request.Status }}'; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞—Ä—ã–π —Å—Ç–∞—Ç—É—Å
            });
        }
        
        function showNotification(message, type) {
            // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 5px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                animation: slideIn 0.3s ease-out;
            `;
            
            if (type === 'success') {
                notification.style.backgroundColor = '#4CAF50';
            } else {
                notification.style.backgroundColor = '#f44336';
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // –í—ã–¥–µ–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            const currentStatus = '{{ .logistic_request.Status }}';
            document.querySelectorAll('.status-btn').forEach(btn => {
                if (btn.dataset.status === currentStatus) {
                    btn.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>

